# Timestamp: "2025-10-11 20:10:08 (ywatanabe)"
# File: ./src/scitex/scholar/config/default.yaml

# ----------------------------------------
# feature
# ----------------------------------------
scholar_dir: ${SCITEX_DIR:-"~/.scitex"}
project: ${SCITEX_SCHOLAR_PROJECT:-"MASTER"}
debug_mode: ${SCITEX_SCHOLAR_DEBUG_MODE:-false}
enable_auto_enrich: ${SCITEX_SCHOLAR_AUTO_ENRICH:-true}
enable_auto_download: ${SCITEX_SCHOLAR_AUTO_DOWNLOAD:-false}

# ----------------------------------------
# Search Engines
# ----------------------------------------
engines:
  - URL
  - CrossRefLocal
  - Semantic_Scholar
  - CrossRef
  - OpenAlex
  - PubMed
  - arXiv

default_search_limit: 20
max_workers: 4
verify_ssl: true

# ----------------------------------------
# PDF Download
# ----------------------------------------
max_parallel: ${SCITEX_SCHOLAR_PDF_MAX_PARALLEL:-8}
use_parallel: ${SCITEX_SCHOLAR_PDF_USE_PARALLEL:-true}
delay_between_starts: 0.1
default_delay: 10
retry_attempts: 3
timeout: 60
# Note: Download directory is fixed at {scholar_dir}/library/downloads/
# Use get_library_downloads_dir() to access it

# ----------------------------------------
# cache
# ----------------------------------------
# use_cache_engine: ${SCITEX_SCHOLAR_USE_CACHE_ENGINE:-true}
# use_cache_url: ${SCITEX_SCHOLAR_USE_CACHE_URL:-true}
# use_cache_download: ${SCITEX_SCHOLAR_USE_CACHE_DOWNLOAD:-true}
# use_cache_engine: ${SCITEX_SCHOLAR_USE_CACHE_ENGINE:-false}
# use_cache_url: ${SCITEX_SCHOLAR_USE_CACHE_URL:-false}
# use_cache_download: ${SCITEX_SCHOLAR_USE_CACHE_DOWNLOAD:-false}


# ----------------------------------------
# api
# ----------------------------------------
semantic_scholar_api_key: ${SCITEX_SCHOLAR_SEMANTIC_SCHOLAR_API_KEY:-null}
crossref_api_key: ${SCITEX_SCHOLAR_CROSSREF_API_KEY:-null}
pubmed_api_key: ${SCITEX_SCHOLAR_PUBMED_API_KEY:-null}
twocaptcha_api_key: ${SCITEX_SCHOLAR_2CAPTCHA_API_KEY:-null}

# ----------------------------------------
# auth:
# ----------------------------------------
# Search Engine
pubmed_email: ${SCITEX_SCHOLAR_PUBMED_EMAIL:-null}
crossref_email: ${SCITEX_SCHOLAR_CROSSREF_EMAIL:-null}
# Auth
openathens_enabled: ${SCITEX_SCHOLAR_OPENATHENS_ENABLED:-true}
openathens_email: ${SCITEX_SCHOLAR_OPENATHENS_EMAIL:-null}
ezproxy_email: ${SCITEX_SCHOLAR_EZPROXY_EMAIL:-null}
shibboleth_email: ${SCITEX_SCHOLAR_SHIBBOLETH_EMAIL:-null}
openurl_resolver_url: ${SCITEX_SCHOLAR_OPENURL_RESOLVER_URL:-null}
sso_username: ${SCITEX_SCHOLAR_SSO_USERNAME:-null}
sso_password: ${SCITEX_SCHOLAR_SSO_PASSWORD:-null}

# Notification settings
notification_email: ${UNIMELB_EMAIL:-null}
notification_from_email: ${SCITEX_EMAIL_AGENT:-"agent@scitex.ai"}

# Screenshot settings
capture_screenshots: ${SCITEX_SCHOLAR_CAPTURE_SCREENSHOTS:-true}

# ----------------------------------------
# browser:
# ----------------------------------------
chrome_profile_name: ${SCITEX_SCHOLAR_CHROME_PROFILE_NAME:-null}

# Unwanted page URL patterns to close automatically
unwanted_pages_expressions:
  - "chrome-extension://"
  - "pbapi.xyz"
  - "options.html"
  - "newtab"

# ----------------------------------------
# URL Finder
# ----------------------------------------

# DOI prefix to publisher domain mapping
doi_to_domain:
  "10.1038":
    - "nature.com"
    - "springernature.com"
  "10.1016":
    - "sciencedirect.com"
    - "elsevier.com"
  "10.1002":
    - "wiley.com"
    - "onlinelibrary.wiley.com"
  "10.1007":
    - "springer.com"
    - "link.springer.com"
  "10.1126":
    - "science.org"
    - "sciencemag.org"
  "10.1021":
    - "acs.org"
    - "pubs.acs.org"
  "10.1111":
    - "wiley.com"
    - "onlinelibrary.wiley.com"
  "10.1080":
    - "tandfonline.com"
  "10.1177":
    - "sagepub.com"
    - "journals.sagepub.com"
  "10.1093":
    - "oup.com"
    - "academic.oup.com"
  "10.1109":
    - "ieee.org"
    - "ieeexplore.ieee.org"
  "10.1371":
    - "plos.org"
    - "journals.plos.org"
  "10.1073":
    - "pnas.org"
  "10.1136":
    - "bmj.com"
  "10.3389":
    - "frontiersin.org"
  "10.3390":
    - "mdpi.com"

# Available from patterns - high priority for OpenURL resolvers
openurl_available_from_patterns:
  # University of Melbourne specific patterns (based on screenshot)
  # Put these first since they are most specific to your use case
  - "Available from American Association for the Advancement of Science"
  - "Available from JSTOR Archival Journals and Primary Sources Collection"
  - "Available from JSTOR Health & General Sciences"
  - "Available from PubMed Central"
  - "Available from American Physiological Society Paid"

  # Publisher-specific patterns (most reliable)
  - "Available from Nature"
  - "Available from Nature Publishing Group"
  - "Available from ScienceDirect"
  - "Available from Elsevier"
  - "Available from Wiley"
  - "Available from Wiley Online Library"
  - "Available from Springer"
  - "Available from SpringerLink"
  - "Available from Taylor & Francis"
  - "Available from SAGE"
  - "Available from SAGE Publications"
  - "Available from Oxford"
  - "Available from Oxford Academic"
  - "Available from IEEE"
  - "Available from IEEE Xplore"
  - "Available from PLOS"
  - "Available from PLOS ONE"
  - "Available from BMJ"
  - "Available from Frontiers"
  - "Available from MDPI"
  - "Available from American Chemical Society"
  - "Available from ACS"
  - "Available from ACS Publications"
  - "Available from PNAS"
  - "Available from Science"
  - "Available from AAAS"
  - "Available from IEEE"
  - "Available from Institute of Physics"
  - "Available from Unpaywall"
  - "Available from Open Access"

# available_from_patterns:
#   # Generic available patterns
#   - "Full text available from"
#   - "View full text at"
#   - "Access full text from"
#   - "Get full text from"

# Resolver link selectors in priority order
structure_selectors:
  # University of Melbourne specific (based on screenshots)
  - 'tr:has-text("Available from") a:has-text("GO")'
  - 'td a[href*="javascript:openSFXMenuLink"]:has-text("GO")'
  - 'a[title="Navigate to target in new window"]'

  # SFX (ExLibris) - used by many universities
  - "div#fulltext a"
  - "div.sfx-fulltext a"
  - "div.results-title > a"
  - "td.object-cell a"
  - ".getFullTxt a"
  - 'div[id*="fulltext"] a'
  - 'div[class*="fulltext"] a'

  # Primo (ExLibris)
  - "prm-full-view-service-container a"
  - "span.availability-status-available a"

  # Summon (ProQuest)
  - ".summon-fulltext-link"
  - "a.summon-link"

  # EDS (EBSCO)
  - "a.fulltext-link"
  - ".ft-link a"

  # Generic patterns
  - "a.full-text-link"
  - "a.fulltext"
  - "a#full-text-link"
  - ".access-link a"
  - ".available-link a"

text_patterns:
  # Common patterns
  - "View full text"
  - "Full Text from Publisher"
  - "Get full text"
  - "Access full text"
  - "Go to article"
  - "Access article"

  # Generic but reliable
  - "Full Text"
  - "Full text"
  - "Article"
  - "View"
  - "PDF"
  - "Download"
  - "GO"

negative_keywords:
  - "cookie"
  - "policy"
  - "about us"
  - "privacy"
  - "terms"
  - "abstract"
  - "preview"
  - "summary"
  - "citation"
  - "cite this"
  - "request"
  - "interlibrary"
  - "inter library"
  - "loan"


# PDF download selectors for direct link finding
download_selectors:
  # Generic download patterns
  - 'a[data-track-action*="download"]'
  - 'button[data-track-action*="download"]'
  - 'a:has-text("Download PDF")'
  - 'button:has-text("Download PDF")'
  - 'a[download][href*="pdf"]'
  - '.pdf-download-btn'
  - 'a[href*="/pdf/"]'
  - 'a[href*="/doi/pdf/"]'
  - 'a[href*="type=printable"]'

  # Publisher-specific selectors
  # ScienceDirect (Elsevier)
  - 'a.PdfLink'
  - 'a.article-tools-pdf-link'

  # Wiley Online Library
  - 'a#article-pdf-link'
  - 'a.pdf-download'

  # SpringerLink
  - 'a[data-track-action="download pdf"]'
  - 'a.c-pdf-download__link'

  # Oxford Academic
  - 'a.al-link.pdf-link'

dropdown_selectors:
  - 'button:has-text("Download")'
  - '.dropdown-toggle:has-text("Download")'
  - '[data-toggle="dropdown"]:has-text("Download")'
  - ".download-dropdown"
  - 'button[aria-label*="Download"]'

supplementary_selectors:
  - 'a[href*="supplementary"]'
  - 'a[href*="supplement"]'
  - 'a[href*="additional"]'
  - 'a[href*="supporting"]'
  - 'a[href*="SI"]'
  - 'a[href*="ESM"]'

pdf_view_selectors:
  - 'a:has-text("View PDF")'
  - 'a:has-text("PDF")'
  - "a.pdf-link"
  - 'a[href*="/pdf/"]'
  - 'button:has-text("PDF")'
  - 'a#ViewPDF'
  - 'div#accessbar a'

# Deny patterns for filtering out unwanted elements
deny_selectors:
  # Navigation and UI elements
  - 'aside *'
  - '.sidebar *'
  - '.navigation *'
  - '.footer *'
  - '.header *'
  # Recommendation sections
  - '.recommended *'
  - '.related-articles *'
  - '.you-may-also-like *'
  # Social and sharing
  - '.social-share *'
  - '.share-buttons *'
  # Issue/Volume downloads (not single article)
  - 'a:has-text("Download Issue")'
  - 'a:has-text("Download Volume")'
  - 'a:has-text("Full Issue")'

deny_classes:
  - "recommended"
  - "sidebar"
  - "footer-content"
  - "social-share"
  - "issue-download"
  - "volume-download"

deny_text_patterns:
  - "Download Issue"
  - "Download Volume"
  - "Full Issue"
  - "Complete Issue"
  - "Entire Issue"
  - "Subscribe"
  - "Sign up"

# ----------------------------------------
# Publisher-Specific PDF Extraction Rules
# ----------------------------------------
publisher_pdf_rules:
  sciencedirect:
    domain_patterns:
      - "sciencedirect.com"
      - "cell.com"
      - "elsevier.com"
    deny_selectors:
      - 'a[href*="/mmc"]'
      - 'a[href*="supplementary"]'
      - 'a[href*="figure"]'
      - 'a[href*="image"]'
      - 'a[href*="thumb"]'
      - 'a[href*="gr1"]'
      - 'a[href*="gr2"]'
      - 'a[href*="gr3"]'
      - 'a[href*="fx1"]'
      - 'a[href*="mmcr"]'
      - '.recommended-articles a'
      - '.related-articles a'
      - '.reference-list a'
      - '.js-related-article a'
      - '[data-track*="related"]'
      - '[data-track*="recommend"]'
    deny_classes:
      - "thumbnail"
      - "figure-download"
      - "supplementary-material"
      - "related-article-link"
      - "reference-link"
      - "recommended-link"
      - "ppt-download"
      - "xls-download"
    deny_text_patterns:
      - "supplementary"
      - "supporting"
      - "figure"
      - "table"
      - "image"
      - "cited by"
      - "related articles"
      - "recommended articles"
      - "download all"
      - "download zip"
      - "powerpoint"
      - "excel"
      - "video"
      - "audio"
    allowed_pdf_patterns:
      - "/pdfft\\?"
      - "/piis.*\\.pdf"
      - "/science/article/pii.*\\.pdf"
    download_selectors:
      - 'a[aria-label="Download PDF"]'
      - 'a.download-pdf-link:not([href*="supplementary"])'
      - 'button.pdf-download'
      - 'a[data-track-action="download pdf"]:not([href*="mmc"])'

  nature:
    domain_patterns:
      - "nature.com"
    deny_selectors:
      - 'a[href*="figures"]'
      - 'a[href*="tables"]'
      - 'a[href*="extended"]'
      - '.c-article-references a'
    deny_classes:
      - "figure-link"
      - "table-link"
      - "supplementary-link"
    deny_text_patterns:
      - "extended data"
      - "supplementary"
      - "source data"
    allowed_pdf_patterns:
      - "\\.pdf$"
      - "/pdf/"
    download_selectors:
      - 'a[data-track-action="download pdf"]'
      - 'a.c-pdf-download__link'

  wiley:
    domain_patterns:
      - "onlinelibrary.wiley.com"
    deny_selectors:
      - 'a[href*="supporting"]'
      - 'a[href*="appendix"]'
      - '.article-references a'
    deny_classes:
      - "supporting-info"
      - "appendix-link"
    deny_text_patterns:
      - "supporting information"
      - "appendix"
    allowed_pdf_patterns:
      - "/epdf/"
      - "/pdf/"
      - "\\.pdf$"
    download_selectors:
      - 'a[title*="PDF"]'
      - 'a.pdf-link'

  springer:
    domain_patterns:
      - "link.springer.com"
      - "springerlink.com"
    deny_selectors:
      - 'a[href*="supplementary"]'
      - 'a[href*="figures"]'
      - '.c-article-references a'
    deny_classes:
      - "supplementary-material"
      - "figure-link"
    deny_text_patterns:
      - "supplementary"
      - "additional file"
    allowed_pdf_patterns:
      - "\\.pdf$"
      - "/content/pdf/"
    download_selectors:
      - 'a.c-pdf-download-link'
      - 'a[data-track-action="download pdf"]'

  ieee:
    domain_patterns:
      - "ieeexplore.ieee.org"
    deny_selectors:
      - 'a[href*="multimedia"]'
      - 'a[href*="stamp"]'
    deny_classes:
      - "stats-document-abstract-multimedia"
    deny_text_patterns:
      - "multimedia"
      - "view document"
    allowed_pdf_patterns:
      - "/iel\\d+/"
      - "\\.pdf$"
    download_selectors:
      - 'a.pdf-btn-link'
      - 'xpl-pdf-btn-link'

  frontiers:
    domain_patterns:
      - "frontiersin.org"
    deny_selectors:
      - 'a[href*="supplementary"]'
      - 'a[href*="datasheet"]'
    deny_classes:
      - "supplementary-material"
    deny_text_patterns:
      - "supplementary"
      - "data sheet"
    allowed_pdf_patterns:
      - "/pdf/"
      - "\\.pdf$"
    download_selectors:
      - 'a.download-files-pdf'
      - 'a[href*="/pdf/"]'

  plos:
    domain_patterns:
      - "plos.org"
      - "plosone.org"
    deny_selectors:
      - 'a[href*="supplementary"]'
      - 'a[href*="figure"]'
    deny_classes:
      - "supplementary"
    deny_text_patterns:
      - "supporting information"
    allowed_pdf_patterns:
      - "\\.pdf$"
      - "/plosone/article/file"
    download_selectors:
      - 'a#downloadPdf'
      - 'a[id="downloadPdf"]'

# ----------------------------------------
# Authentication
# ----------------------------------------
# Configuration for authentication gateway pattern
# Defines which publishers require authentication and preferred providers
# Active authentication provider (openathens, ezproxy, shibboleth)
auth_active_provider: openathens

# Authentication endpoint patterns for redirect waiting
# These are intermediate endpoints that perform client-side redirects
auth_endpoint_patterns:
  # OpenAthens
  - "go.openathens.net"
  - "login.openathens.net"
  # Elsevier
  - "auth.elsevier.com"
  - "login.elsevier.com"
  - "secure.jbs.elsevierhealth.com"
  # Nature
  - "idp.nature.com"
  # Generic SSO patterns
  - "shibboleth"
  - "saml"
  - "/ShibAuth/"
  - "/authenticate"
  - "/login"
  - "/signin"
  - "/sso/"

# Article URL indicators (for detecting final destination)
article_url_patterns:
  - "/science/article/"
  - "/articles/"
  - "/content/"
  - "/full/"
  - "/fulltext/"
  - "/doi/full/"
  - "/doi/abs/"
  - "/doi/pdf/"
  - ".pdf"

# Publishers requiring authentication (paywalled content)
# Gateway will visit OpenURL to establish publisher-specific session cookies
paywalled_publishers:
  - name: IEEE
    doi_prefixes:
      - "10.1109"  # IEEE DOI prefix
    domain_patterns:
      - "ieeexplore.ieee.org"
      - "ieee.org"
    preferred_provider: openathens

  - name: Springer
    doi_prefixes:
      - "10.1007"  # Springer DOI prefix
    domain_patterns:
      - "link.springer.com"
      - "springer.com"
      - "springernature.com"
    preferred_provider: openathens

  - name: Wiley
    doi_prefixes:
      - "10.1002"  # Wiley DOI prefix
      - "10.1111"  # Wiley alternate prefix
    domain_patterns:
      - "onlinelibrary.wiley.com"
      - "wiley.com"
    preferred_provider: openathens

  - name: Nature
    doi_prefixes:
      - "10.1038"  # Nature DOI prefix
    domain_patterns:
      - "nature.com"
      - "springernature.com"
    preferred_provider: openathens

  - name: ScienceDirect
    doi_prefixes:
      - "10.1016"  # Elsevier/ScienceDirect DOI prefix
    domain_patterns:
      - "sciencedirect.com"
      - "elsevier.com"
    preferred_provider: openathens

  - name: Taylor & Francis
    domain_patterns:
      - "tandfonline.com"
      - "taylorfrancis.com"
    preferred_provider: openathens

  - name: Oxford University Press
    domain_patterns:
      - "academic.oup.com"
      - "oup.com"
    preferred_provider: openathens

  - name: Cambridge University Press
    domain_patterns:
      - "cambridge.org"
    preferred_provider: openathens

  - name: SAGE
    domain_patterns:
      - "journals.sagepub.com"
      - "sagepub.com"
    preferred_provider: openathens

  - name: ACS Publications
    domain_patterns:
      - "pubs.acs.org"
      - "acs.org"
    preferred_provider: openathens

  - name: IOP Publishing
    doi_prefixes:
      - "10.1088"  # IOP DOI prefix
    domain_patterns:
      - "iopscience.iop.org"
      - "iop.org"
    preferred_provider: openathens

  - name: SSRN
    doi_prefixes:
      - "10.2139"  # SSRN DOI prefix
    domain_patterns:
      - "ssrn.com"
      - "papers.ssrn.com"
    preferred_provider: openathens

  - name: Lancet
    doi_prefixes:
      - "10.1016"  # Lancet uses Elsevier DOIs (same as ScienceDirect)
    domain_patterns:
      - "thelancet.com"
      - "lancet.com"
    preferred_provider: openathens

# EOF